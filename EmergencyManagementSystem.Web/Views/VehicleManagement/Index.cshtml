@using EmergencyManagementSystem.Service.Models
@model EmergencyModel

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    List<string> Messages = ViewBag?.Error;
    List<EmergencyModel> emergencies = ViewBag.Emergencies;
    EmergencyRequiredVehicleModel requiredVehicle = @Model?.EmergencyRequiredVehicleModels?.FirstOrDefault() ?? new EmergencyRequiredVehicleModel();
    ServiceHistoryModel serviceHistoryModel = @Model?.ServiceHistoryModels?.FirstOrDefault() ?? new ServiceHistoryModel();
}


<div class="content">
    @if (Messages != null)
    {
        <div class="m-b-3" id="error-notification">
            <div class="callout callout-info" style="margin-bottom: 0!important;">
                <h4><i class="fa fa-warning"></i> Nota:</h4>
                @foreach (string error in Messages)
                {
                    @error<br />
                }
            </div>
        </div>
    }
    <div class="row">
        <div class="col-lg-4">

            <div id="refTable">
                @Html.Partial("Emergencies", emergencies)
            </div>
        </div>


        <div class="col-lg-8">
            <div class="info-box">
                <div class="card tab-style1">
                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs profile-tab" role="tablist">
                        <li class="nav-item" > <a class="nav-link" data-toggle="tab" href="#home" role="tab" aria-expanded="false">Enviar Veículo</a> </li>
                        <li class="nav-item"> <a class="nav-link" data-toggle="tab" href="#profile" role="tab" aria-expanded="false">Dados da Ocorrência</a> </li>
                        <li class="nav-item"> <a class="nav-link active" data-toggle="tab" href="#main" role="tab" aria-expanded="true">Controle de Veículos</a> </li>
                    </ul>

                    <!-- TAB DE ESCOLHA DE VEÍCULO PARA EMPENHAR NA VTR -->
                    <div class="tab-content">
                        <div class="tab-pane" id="home" role="tabpanel" aria-expanded="false" >
                            <div class="row m-t-3-1">
                                <div class="col-lg-12">
                                    <div class="card-body">
                                        <form method="post" action="@Url.Action("Register", "VehicleManagement")">
                                            <h4 class="text-white">OC: @(Model?.Id) - @Model.Name<span class="pull-right"><b>@Model.Date.ToShortDateString()  @Model.Date.ToShortTimeString()</b></span> </h4>
                                            <h5 class="text-white"><b>Solicitante:</b> @Model.RequesterName<span class="pull-right"><b>Funcionário:</b> @Model.EmployeeName</span> </h5>
                                            <h5 class="text-white"><b>Telefone:</b> @Model.RequesterPhone<span class="pull-right"></span> </h5>
                                            <hr />

                                            <div class="sidebar-menu" data-widget="tree">
                                                <div class="treeview">
                                                    <a href="#" onclick="Pesquisar()"> <i class="fa fa-map-marker"></i> <span>Localização</span> <span class="pull-right-container"> <i class="fa fa-angle-left pull-right"></i> </span> </a>
                                                    <div class="treeview-menu">

                                                        <label>
                                                            @Model.AddressModel.City/@Model.AddressModel.District - @Model.AddressModel.Street, @Model.AddressModel.Number
                                                            @Model.AddressModel.Complement. Prox: @Model.AddressModel.Reference
                                                        </label>
                                                        <input id="pac-input"
                                                               class="controls"
                                                               type="text"
                                                               placeholder="Procurar" value="@Model.AddressModel.Street - @Model.AddressModel.District, @Model.AddressModel.City" />

                                                        <div id="map">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <hr />
                                            <h5 class="box-title text-white">
                                                Veículo: @requiredVehicle.VehicleType.GetEnumDescription() - Código: @requiredVehicle.CodeColor.GetEnumDescription()
                                            </h5>
                                            <!--Listar Veículos disponíveis-->
                                            <div class="">
                                                <div class="row">

                                                    <div class="col-md-3">
                                                        <div class="info-box">
                                                            <span class="info-box-icon bg-red"><i class="fa fa-ambulance"></i></span>
                                                            <span class=""> <span class="info-box-number">USB</span> <span class="info-box-text"></span> </span>
                                                        </div>
                                                        <center>
                                                            <h5><a href="#">Blumenau <i class="fa fa-mail-forward"></i></a></h5>
                                                        </center>
                                                    </div>

                                                    <div class="col-md-3">
                                                        <div class="info-box">
                                                            <span class="info-box-icon bg-red"><i class="fa fa-ambulance"></i></span>
                                                            <span class=""> <span class="info-box-number">USA</span> <span class="info-box-text"></span> </span>
                                                        </div>
                                                        <center>
                                                            <h5><a href="#">Rio do Sul <i class="fa fa-mail-forward"></i></a></h5>
                                                        </center>
                                                    </div>

                                                    <div class="col-md-3">
                                                        <div class="info-box">
                                                            <span class="info-box-icon bg-red"><i class="fas fa-helicopter"></i></span>
                                                            <span class=""> <span class="info-box-number">HEL</span> <span class="info-box-text"></span> </span>
                                                        </div>
                                                        <center>
                                                            <h5><a href="#">Indaial <i class="fa fa-mail-forward"></i></a></h5>
                                                        </center>
                                                    </div>

                                                    <div class="col-md-3">

                                                        <div class="info-box">
                                                            <span class="info-box-icon bg-red"><i class="fa fa-plane"></i></span>
                                                            <span class=""> <span class="info-box-number">AVI</span> <span class="info-box-text"></span> </span>
                                                        </div>
                                                        <center>
                                                            <h5><a href="#">Blumenau <i class="fa fa-mail-forward"></i></a></h5>
                                                        </center>
                                                    </div>

                                                </div>
                                            </div>

                                            <hr />

                                            <div class="">
                                                <button id="btnCancel" onclick="appendCancel()" class="btn btn-block bg-light">Cancelar Veículo</button>
                                            </div>
                                            <input hidden name="Status" value="@requiredVehicle.Status" />
                                            <div id="cancel" class="hide">
                                                <hr />
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group has-feedback">
                                                            <label class="control-label">Comentário</label>
                                                            <textarea class="form-control" id="placeTextarea" rows="1" placeholder="Observação"></textarea>
                                                        </div>
                                                    </div>

                                                    <div class="col-md-12">
                                                        <button type="submit" class="btn btn-sm bg-purpleTest">Registrar Cancelamento</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <!--TAB DADOS DA OCORRENCIA-->
                        <div class="tab-pane" id="profile" role="tabpanel" aria-expanded="false">

                            <div class="row m-t-3-1">
                                <div class="col-lg-12">
                                    <div class="card-body">
                                        <h4 class="text-white">OC: @(Model?.Id) - @Model.Name<span class="pull-right"><b>@Model.Date.ToShortDateString()  @Model.Date.ToShortTimeString()</b></span> </h4>
                                        <h5 class="text-white"><b>Solicitante:</b> @Model.RequesterName<span class="pull-right"><b>Funcionário:</b> @Model.EmployeeName</span> </h5>
                                        <h5 class="text-white"><b>Telefone:</b> @Model.RequesterPhone<span class="pull-right"></span> </h5>
                                        <hr />

                                        <div class="sidebar-menu" data-widget="tree">
                                            <div class="treeview">
                                                <a href="#" onclick="Search()"> <i class="fa fa-map-marker"></i> <span>Localização</span> <span class="pull-right-container"> <i class="fa fa-angle-left pull-right"></i> </span> </a>
                                                <div class="treeview-menu">

                                                    <label>
                                                        @Model.AddressModel.City/@Model.AddressModel.District - @Model.AddressModel.Street, @Model.AddressModel.Number
                                                        @Model.AddressModel.Complement. Prox: @Model.AddressModel.Reference
                                                    </label>
                                                    <input id="pac-input"
                                                           class="controls"
                                                           type="text"
                                                           placeholder="Procurar" value="@Model.AddressModel.Street - @Model.AddressModel.District, @Model.AddressModel.City" />
                                                    <div id="map">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <hr />

                                        <div class="box-header with-border">
                                            <h5 class="box-title text-white">
                                                Histórico de Avaliação Médica
                                            </h5>
                                        </div>
                                        <div class="direct-chat-messages">
                                            <table id="" class="table table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th class="wt20">Data</th>
                                                        <th class="wt15">Profissional</th>
                                                        <th class="wt15">Paciente</th>
                                                        <th class="wt50">Avaliação</th>
                                                    </tr>
                                                </thead>
                                                <tbody class="">
                                                    @foreach (var item in Model.MedicalEvaluationModels)
                                                    {
                                                        <tr>
                                                            <td>@item.Date</td>
                                                            <td>@item.EmployeeName</td>
                                                            <td>@(item?.PatientModel?.Name ?? "")</td>
                                                            <td>@item.Evaluation</td>
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                        </div>
                                        <br />
                                        <hr />
                                        <!--Implementar os J's aqui-->
                                        <h5 class="box-title text-white">
                                            Posição da viatura - @serviceHistoryModel.VehicleModel.Codename
                                        </h5>
                                        <div class="card-group align-items-center">
                                            <div class="col-2">
                                                <div class="form-group has-feedback">
                                                    <a href="#"><label class="control-label"> + J9 </label></a>
                                                    <input class="form-control" type="text" id="PA-">
                                                </div>
                                            </div>
                                            <div class="col-2">

                                                <div class="form-group has-feedback">
                                                    <a href="#"><label class="control-label"> + J10 </label></a>
                                                    <input class="form-control" type="text" id="FC-">
                                                </div>
                                            </div>
                                            <div class="col-2">

                                                <div class="form-group has-feedback">
                                                    <a href="#"><label class="control-label"> + J9 </label></a>
                                                    <input class="form-control" type="text" id="FR-">
                                                </div>
                                            </div>
                                            <div class="col-2">
                                                <div class="form-group has-feedback">
                                                    <a href="#"><label class="control-label"> + J10 </label></a>
                                                    <input class="form-control" type="text" id="Temp-">
                                                </div>
                                            </div>
                                            <div class="col-2">
                                                <div class="form-group has-feedback">
                                                    <a href="#"><label class="control-label"> + J11 </label></a>
                                                    <input class="form-control" type="text" id="Sat02-">
                                                </div>
                                            </div>
                                            <div class="col-2">
                                                <div class="form-group has-feedback">
                                                    <a href="#"><label class="control-label"> + J12 </label></a>
                                                    <input class="form-control" type="text" id="HGT-">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="card-group align-items-center">
                                            <div class="col-2">
                                                <span class="info-box-icon bg-red"><i class="fa fa-ambulance"></i></span>
                                            </div>
                                            <div class="col-2">
                                                <span class="info-box-icon bg-red"><i class="fa fa-ambulance"></i></span>
                                            </div>
                                            <div class="col-2">
                                                <span class="info-box-icon bg-red"><i class="fa fa-ambulance"></i></span>
                                            </div>
                                            <div class="col-2">
                                                <span class="info-box-icon bg-red"><i class="fa fa-ambulance"></i></span>
                                            </div>
                                            <div class="col-2">
                                                <span class="info-box-icon bg-red"><i class="fa fa-ambulance"></i></span>
                                            </div>
                                            <div class="col-2">
                                                <span class="info-box-icon bg-red"><i class="fa fa-ambulance"></i></span>
                                            </div>

                                        </div>
                                        <hr />

                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group has-feedback">
                                                    <label class="control-label">Intercorrências</label>
                                                    <textarea class="form-control" id="Evaluation-1" rows="2"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-5">
                                                <button type="submit" class="btn btn-sm bg-purpleTest"><i class="fa fa-save"></i> Gravar</button>
                                            </div>
                                        </div>
                                        <hr />

                                        <div class="">
                                            <a id="btnRegister" class="btn btn-block bg-purpleTest">Concluído</a>
                                        </div>

                                        <hr />
                                        <span class="pull-right">
                                            <button id="btnCancelar1" class="btn btn-nor bg-light">Cancelar Viatura</button>
                                        </span>
                                        <br />
                                    </div><!--ACaba card body da pagina-->

                                </div>
                            </div>
                        </div>


                        <!--TAB CONTROLE DE VEICULOS-->
                        <div class="tab-pane active" id="main" role="tabpanel" aria-expanded="true">

                            <div class="row m-t-3-1">
                                <div class="col-lg-12">
                                    <div class="card-body">


                                        <!--MODELO OCORRENCIA EM ANDAMENTO-->
                                        <div class="col-lg-12">
                                            <div class="small-box bg-red">
                                                <div class="inner">
                                                    <div class="text-left">
                                                        <h5>OC: 14456874 - Dor no peito e dispneia  -  (USB01)</h5>
                                                    </div>


                                                    <!-- TALVEZ SERIA LEGAL MUDAR A COR DO IMPUT ONDE O VEICULO ESTÁ-->
                                                    <div class="card-group align-items-center">
                                                        <div class="col-2">
                                                            <div class="form-group has-feedback">
                                                                <a href="#"><label class="control-label"> + J9 </label></a>
                                                                <input class="form-control" type="text" id="PA-">
                                                            </div>
                                                        </div>
                                                        <div class="col-2">

                                                            <div class="form-group has-feedback">
                                                                <a href="#"><label class="control-label"> + J10 </label></a>
                                                                <input class="form-control" type="text" id="FC-">
                                                            </div>
                                                        </div>
                                                        <div class="col-2">

                                                            <div class="form-group has-feedback">
                                                                <a href="#"><label class="control-label"> + J9 </label></a>
                                                                <input class="form-control" type="text" id="FR-">
                                                            </div>
                                                        </div>
                                                        <div class="col-2">
                                                            <div class="form-group has-feedback">
                                                                <a href="#"><label class="control-label"> + J10 </label></a>
                                                                <input class="form-control" type="text" id="Temp-">
                                                            </div>
                                                        </div>
                                                        <div class="col-2">
                                                            <div class="form-group has-feedback">
                                                                <a href="#"><label class="control-label"> + J11 </label></a>
                                                                <input class="form-control" type="text" id="Sat02-">
                                                            </div>
                                                        </div>
                                                        <div class="col-2">
                                                            <div class="form-group has-feedback">
                                                                <a href="#"><label class="control-label"> + J12 </label></a>
                                                                <input class="form-control" type="text" id="HGT-">
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>

                                        <!--MODELO OCORRENCIA EM ANDAMENTO-->
                                        <div class="col-lg-12">
                                            <div class="small-box bg-yellow">
                                                <div class="inner">
                                                    <div class="text-left">
                                                        <h5>OC: 14456874 - Dor no peito e dispneia  -  (USB01)</h5>
                                                    </div>


                                                    <!-- TALVEZ SERIA LEGAL MUDAR A COR DO IMPUT ONDE O VEICULO ESTÁ-->
                                                    <div class="card-group align-items-center">
                                                        <div class="col-2">
                                                            <div class="form-group has-feedback">
                                                                <a href="#"><label class="control-label"> + J9 </label></a>
                                                                <input class="form-control" type="text" id="PA-">
                                                            </div>
                                                        </div>
                                                        <div class="col-2">

                                                            <div class="form-group has-feedback">
                                                                <a href="#"><label class="control-label"> + J10 </label></a>
                                                                <input class="form-control" type="text" id="FC-">
                                                            </div>
                                                        </div>
                                                        <div class="col-2">

                                                            <div class="form-group has-feedback">
                                                                <a href="#"><label class="control-label"> + J9 </label></a>
                                                                <input class="form-control" type="text" id="FR-">
                                                            </div>
                                                        </div>
                                                        <div class="col-2">
                                                            <div class="form-group has-feedback">
                                                                <a href="#"><label class="control-label"> + J10 </label></a>
                                                                <input class="form-control" type="text" id="Temp-">
                                                            </div>
                                                        </div>
                                                        <div class="col-2">
                                                            <div class="form-group has-feedback">
                                                                <a href="#"><label class="control-label"> + J11 </label></a>
                                                                <input class="form-control" type="text" id="Sat02-">
                                                            </div>
                                                        </div>
                                                        <div class="col-2">
                                                            <div class="form-group has-feedback">
                                                                <a href="#"><label class="control-label"> + J12 </label></a>
                                                                <input class="form-control" type="text" id="HGT-">
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>




                                    </div><!--ACaba card body da pagina-->

                                </div>
                            </div>
                        </div>



                    </div> @*Final TabContent*@
                </div>
            </div>
        </div>
    </div>
    <!-- Main row -->
</div>


<style>
</style>

<script src='https://kit.fontawesome.com/a076d05399.js' crossorigin='anonymous'></script>
<script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyClYGY0602EMNEOdHTFm0UWoisuKoF73u4&region=BR&language=pt&callback=initAutocomplete&libraries=places&v=weekly"></script>
<link href="~/css/maps.css" rel="stylesheet" />
<script src="~/js/maps.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>


<script>

    function RefreshEmergencies() {
        $.ajax({
            url: '/VehicleManagement/Emergencies',
            type: "GET",
            success: function (partialViewResult) {
                debugger;
                $("#refTable").empty();
                $("#refTable").append(partialViewResult);
            }
        })
    }

    window.setInterval(RefreshEmergencies, 5000);

</script>

<script>
    function now() {
        var now = Date.now();
        now.format("dd/MM hh:mm");
        return now;
    }
</script>

<script>
    //Cuidado ao mexer

    $(function () {
        $('#example1').DataTable()
        $('#example2').DataTable({
            'paging': false,
            'lengthChange': false,
            'searching': false,
            'ordering': false,
            'info': false,
            'autoWidth': false,
            'scrollY': "200px",
            'scrollCollapse': true,
            'responsive': true
        })
    })



    function appendCancel() {
        $('#btnCancel').attr('disabled', true);
        $('#btnRegister').attr('disabled', true);
        $("#cancel").removeClass();
    }

    function Search() {
        window.setTimeout(SearchTimer, 1000);
    }

    function SearchTimer() {
        var input = document.getElementById('pac-input');

        google.maps.event.trigger(input, 'focus', {});
        google.maps.event.trigger(input, 'keydown', { keyCode: 13 });
        google.maps.event.trigger(this, 'focus', {});
    }
</script>


